import { GoogleGenAI } from "@google/genai";

const apiKey = process.env.API_KEY || '';
const ai = new GoogleGenAI({ apiKey });

export const generateMotivation = async (
  status: 'TAKEN' | 'MISSED',
  streak: number,
  balance: number
): Promise<string> => {
  if (!apiKey) {
    return status === 'TAKEN' 
      ? "–û—Ç–ª–∏—á–Ω–æ! –¢–∞–∫ –¥–µ—Ä–∂–∞—Ç—å! üåü" 
      : "–ù–µ —Ä–∞—Å—Å—Ç—Ä–∞–∏–≤–∞–π—Å—è, –∑–∞–≤—Ç—Ä–∞ –±—É–¥–µ—Ç –ª—É—á—à–µ. üí™";
  }

  try {
    const prompt = `
      –¢—ã ‚Äî –∑–∞–±–æ—Ç–ª–∏–≤—ã–π –∏ –æ—Å—Ç—Ä–æ—É–º–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ "–¢–∞–±–ª–µ—Ç–∫–∞ –°–≤–µ—Ç—ã".
      –°–≤–µ—Ç–∞ —Ç–æ–ª—å–∫–æ —á—Ç–æ –æ—Ç–º–µ—Ç–∏–ª–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–∏–≤—ã—á–∫–∏ (–ø—Ä–∏–µ–º —Ç–∞–±–ª–µ—Ç–æ–∫).
      
      –ö–æ–Ω—Ç–µ–∫—Å—Ç:
      - –°—Ç–∞—Ç—É—Å –¥–µ–π—Å—Ç–≤–∏—è: ${status === 'TAKEN' ? '–í—ã–ø–∏–ª–∞ —Ç–∞–±–ª–µ—Ç–∫—É (+500 —Ä—É–±)' : '–ü—Ä–æ–ø—É—Å—Ç–∏–ª–∞ (-1000 —Ä—É–±)'}
      - –¢–µ–∫—É—â–∏–π —Å—Ç—Ä–∏–∫ (–¥–Ω–µ–π –ø–æ–¥—Ä—è–¥): ${streak}
      - –¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å: ${balance} —Ä—É–±.

      –ó–∞–¥–∞—á–∞:
      –ù–∞–ø–∏—à–∏ –æ—á–µ–Ω—å –∫–æ—Ä–æ—Ç–∫—É—é (–º–∞–∫—Å–∏–º—É–º 1-2 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è), —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—É—é –∏ –∂–∏–≤—É—é —Ä–µ–∞–∫—Ü–∏—é.
      –ï—Å–ª–∏ –≤—ã–ø–∏–ª–∞: –ø–æ—Ö–≤–∞–ª–∏, –æ—Ç–º–µ—Ç—å —Å—Ç—Ä–∏–∫ –∏–ª–∏ –∑–∞—Ä–∞–±–æ—Ç–æ–∫. –ò—Å–ø–æ–ª—å–∑—É–π —ç–º–æ–¥–∑–∏.
      –ï—Å–ª–∏ –ø—Ä–æ–ø—É—Å—Ç–∏–ª–∞: –º—è–≥–∫–æ –ø–æ–∂—É—Ä–∏, —Å–∫–∞–∂–∏, —á—Ç–æ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞ —Å—Ç–æ–∏—Ç –¥–æ—Ä–æ–≥–æ, –Ω–æ –ø–æ–¥–¥–µ—Ä–∂–∏.
      –Ø–∑—ã–∫: –†—É—Å—Å–∫–∏–π. –°—Ç–∏–ª—å: –¥—Ä—É–∂–µ—Å–∫–∏–π, —Å–ª–µ–≥–∫–∞ –∏–≥—Ä–∏–≤—ã–π.
    `;

    const response = await ai.models.generateContent({
      model: 'gemini-2.5-flash',
      contents: prompt,
    });

    return response.text?.trim() || (status === 'TAKEN' ? "–ú–æ–ª–æ–¥–µ—Ü!" : "–°–æ–±–µ—Ä–∏—Å—å!");
  } catch (error) {
    console.error("Gemini API Error:", error);
    return status === 'TAKEN' ? "–°—É–ø–µ—Ä! –ë–∞–ª–∞–Ω—Å –ø–æ–ø–æ–ª–Ω–µ–Ω." : "–≠—Ö, –º–∏–Ω—É—Å 1000. –ù–µ —Å–¥–∞–≤–∞–π—Å—è!";
  }
};